var ARjs=ARjs||{},THREEx=THREEx||{};ARjs.MarkerControls=THREEx.ArMarkerControls=function(t,e,r){var a=this;THREEx.ArBaseControls.call(this,e),this.context=t,this.parameters={size:1,type:"unknown",patternUrl:null,barcodeValue:null,changeMatrixMode:"modelViewMatrix",minConfidence:.6};var o=["pattern","barcode","unknown"];console.assert(-1!==o.indexOf(this.parameters.type),"illegal value",this.parameters.type),o=["modelViewMatrix","cameraTransformMatrix"],console.assert(-1!==o.indexOf(this.parameters.changeMatrixMode),"illegal value",this.parameters.changeMatrixMode),this.object3d=e,this.object3d.matrixAutoUpdate=!1,this.object3d.visible=!1,function(t){if(void 0!==t)for(var e in t){var r=t[e];void 0!==r?void 0!==a.parameters[e]?a.parameters[e]=r:console.warn("THREEx.ArMarkerControls: '"+e+"' is not a property of this material."):console.warn("THREEx.ArMarkerControls: '"+e+"' parameter is undefined.")}}(r),t.addMarker(this),"artoolkit"===a.context.parameters.trackingBackend?this._initArtoolkit():"aruco"===a.context.parameters.trackingBackend?this._arucoPosit=new POS.Posit(this.parameters.size,a.context.arucoContext.canvas.width):"tango"===a.context.parameters.trackingBackend?this._initTango():console.assert(!1)},ARjs.MarkerControls.prototype=Object.create(THREEx.ArBaseControls.prototype),ARjs.MarkerControls.prototype.constructor=THREEx.ArMarkerControls,ARjs.MarkerControls.prototype.dispose=function(){this.context.removeMarker(this)},ARjs.MarkerControls.prototype.updateWithModelViewMatrix=function(t){var e=this.object3d;if(e.visible=!0,"artoolkit"===this.context.parameters.trackingBackend){var r=(new THREE.Matrix4).copy(this.context._artoolkitProjectionAxisTransformMatrix);r.multiply(t),t.copy(r)}else"aruco"===this.context.parameters.trackingBackend||"tango"===this.context.parameters.trackingBackend||console.assert(!1);if("tango"!==this.context.parameters.trackingBackend){var a=(new THREE.Matrix4).makeRotationX(Math.PI/2);t.multiply(a)}"modelViewMatrix"===this.parameters.changeMatrixMode?e.matrix.copy(t):"cameraTransformMatrix"===this.parameters.changeMatrixMode?e.matrix.getInverse(t):console.assert(!1),e.matrix.decompose(e.position,e.quaternion,e.scale),this.dispatchEvent({type:"markerFound"})},ARjs.MarkerControls.prototype.name=function(){var t="";return t+=this.parameters.type,"pattern"===this.parameters.type?t+=" - "+this.parameters.patternUrl.replace(/^.*\//g,""):"barcode"===this.parameters.type?t+=" - "+this.parameters.barcodeValue:console.assert(!1,"no .name() implemented for this marker controls"),t},ARjs.MarkerControls.prototype._initArtoolkit=function(){var t=this,e=null,r=setInterval((function(){var o;null!==t.context.arController&&(clearInterval(r),r=null,o=t.context.arController,console.assert(null!==o),"pattern"===t.parameters.type?o.loadMarker(t.parameters.patternUrl,(function(r){e=r,o.trackPatternMarkerId(e,t.parameters.size)})):"barcode"===t.parameters.type?(e=t.parameters.barcodeValue,o.trackBarcodeMarkerId(e,t.parameters.size)):"unknown"===t.parameters.type?e=null:console.log(!1,"invalid marker type",t.parameters.type),o.addEventListener("getMarker",(function(r){if(r.data.type===artoolkit.PATTERN_MARKER&&"pattern"===t.parameters.type){if(null===e)return;r.data.marker.idPatt===e&&a(r)}else if(r.data.type===artoolkit.BARCODE_MARKER&&"barcode"===t.parameters.type){if(null===e)return;r.data.marker.idMatrix===e&&a(r)}else r.data.type===artoolkit.UNKNOWN_MARKER&&"unknown"===t.parameters.type&&a(r)})))}),20);return;function a(e){if(!(e.data.type===artoolkit.PATTERN_MARKER&&e.data.marker.cfPatt<t.parameters.minConfidence||e.data.type===artoolkit.BARCODE_MARKER&&e.data.marker.cfMatt<t.parameters.minConfidence)){var r=(new THREE.Matrix4).fromArray(e.data.matrix);t.updateWithModelViewMatrix(r)}}},ARjs.MarkerControls.prototype._initAruco=function(){this._arucoPosit=new POS.Posit(this.parameters.size,_this.context.arucoContext.canvas.width)},ARjs.MarkerControls.prototype._initTango=function(){console.log("init tango ArMarkerControls")};