"use strict";void 0===THREE.LoaderSupport&&(THREE.LoaderSupport={}),THREE.LoaderSupport.Validator={isValid:function(e){return null!=e},verifyInput:function(e,t){return null==e?t:e}},THREE.LoaderSupport.Callbacks=function(){var e=THREE.LoaderSupport.Validator;function t(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}return t.prototype.setCallbackOnProgress=function(t){this.onProgress=e.verifyInput(t,this.onProgress)},t.prototype.setCallbackOnMeshAlter=function(t){this.onMeshAlter=e.verifyInput(t,this.onMeshAlter)},t.prototype.setCallbackOnLoad=function(t){this.onLoad=e.verifyInput(t,this.onLoad)},t.prototype.setCallbackOnLoadMaterials=function(t){this.onLoadMaterials=e.verifyInput(t,this.onLoadMaterials)},t}(),THREE.LoaderSupport.LoadedMeshUserOverride=function(){function e(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]}return e.prototype.addMesh=function(e){this.meshes.push(e),this.alteredMesh=!0},e.prototype.isDisregardMesh=function(){return this.disregardMesh},e.prototype.providesAlteredMeshes=function(){return this.alteredMesh},e}(),THREE.LoaderSupport.ResourceDescriptor=function(){var e=THREE.LoaderSupport.Validator;function t(t,r){var i=t.split("/");i.length<2?(this.path=null,this.name=t,this.url=t):(this.path=e.verifyInput(i.slice(0,i.length-1).join("/")+"/",null),this.name=e.verifyInput(i[i.length-1],null),this.url=t),this.extension=e.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}return t.prototype.setContent=function(t){this.content=e.verifyInput(t,null)},t}(),THREE.LoaderSupport.PrepData=function(){var e=THREE.LoaderSupport.Validator;function t(t){this.logging={enabled:!0,debug:!1},this.modelName=e.verifyInput(t,""),this.resources=[],this.callbacks=new THREE.LoaderSupport.Callbacks}return t.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},t.prototype.getCallbacks=function(){return this.callbacks},t.prototype.addResource=function(e){this.resources.push(e)},t.prototype.clone=function(){var e,t,r=new THREE.LoaderSupport.PrepData(this.modelName);for(e in r.logging.enabled=this.logging.enabled,r.logging.debug=this.logging.debug,r.resources=this.resources,r.callbacks=this.callbacks,this)t=this[e],r.hasOwnProperty(e)||"function"==typeof this[e]||(r[e]=t);return r},t.prototype.checkResourceDescriptorFiles=function(t,r){var i,o,n,s,a={};for(var l in t)if(i=t[l],s=!1,e.isValid(i.name))if(e.isValid(i.content)){for(n=0;n<r.length&&!s;n++)if(o=r[n],i.extension.toLowerCase()===o.ext.toLowerCase())if(o.ignore)s=!0;else if("ArrayBuffer"===o.type){if(!(i.content instanceof ArrayBuffer||i.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";a[o.ext]=i,s=!0}else if("String"===o.type){if(!("string"==typeof i.content||i.content instanceof String))throw"Provided  content is not of type String! Aborting...";a[o.ext]=i,s=!0}if(!s)throw'Unidentified resource "'+i.name+'": '+i.url}else{if(!("string"==typeof i.name||i.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(n=0;n<r.length&&!s;n++)o=r[n],i.extension.toLowerCase()===o.ext.toLowerCase()&&(o.ignore||(a[o.ext]=i),s=!0);if(!s)throw'Unidentified resource "'+i.name+'": '+i.url}return a},t}(),THREE.LoaderSupport.MeshBuilder=function(){var e=THREE.LoaderSupport.Validator;function t(){console.info("Using THREE.LoaderSupport.MeshBuilder version: 1.2.0"),this.logging={enabled:!0,debug:!1},this.callbacks=new THREE.LoaderSupport.Callbacks,this.materials=[]}return t.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},t.prototype.init=function(){var e=new THREE.MeshStandardMaterial({color:14479871});e.name="defaultMaterial";var t=new THREE.MeshStandardMaterial({color:14479871});t.name="defaultVertexColorMaterial",t.vertexColors=THREE.VertexColors;var r=new THREE.LineBasicMaterial;r.name="defaultLineMaterial";var i=new THREE.PointsMaterial({size:1});i.name="defaultPointMaterial";var o={};o[e.name]=e,o[t.name]=t,o[r.name]=r,o[i.name]=i,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:o}})},t.prototype.setMaterials=function(t){var r={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:e.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(t):t}};this.updateMaterials(r)},t.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials)},t.prototype.processPayload=function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},t.prototype.buildMeshes=function(t){var r,i,o,n=t.params.meshName,s=new THREE.BufferGeometry;s.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t.buffers.vertices),3)),e.isValid(t.buffers.indices)&&s.setIndex(new THREE.BufferAttribute(new Uint32Array(t.buffers.indices),1)),e.isValid(t.buffers.colors)&&s.addAttribute("color",new THREE.BufferAttribute(new Float32Array(t.buffers.colors),3)),e.isValid(t.buffers.normals)?s.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(t.buffers.normals),3)):s.computeVertexNormals(),e.isValid(t.buffers.uvs)&&s.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(t.buffers.uvs),2));var a=t.materials.materialNames,l=t.materials.multiMaterial,u=[];for(o in a)i=a[o],r=this.materials[i],l&&u.push(r);if(l){r=u;var c,p=t.materials.materialGroups;for(o in p)c=p[o],s.addGroup(c.start,c.count,c.index)}var d,h,g,f=[],m=this.callbacks.onMeshAlter,b=!0,k=e.verifyInput(t.geometryType,0);if(e.isValid(m)&&(h=m({detail:{meshName:n,bufferGeometry:s,material:r,geometryType:k}}),e.isValid(h))){if(!h.isDisregardMesh()&&h.providesAlteredMeshes())for(var y in h.meshes)f.push(h.meshes[y]);b=!1}if(b&&(t.computeBoundingSphere&&s.computeBoundingSphere(),(d=0===k?new THREE.Mesh(s,r):1===k?new THREE.LineSegments(s,r):new THREE.Points(s,r)).name=n,f.push(d)),e.isValid(f)&&f.length>0){var w=[];for(var y in f)d=f[y],w[y]=d.name;g="Adding mesh(es) ("+w.length+": "+w+") from input mesh: "+n,g+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)"}else g="Not adding mesh: "+n,g+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)";var R=this.callbacks.onProgress;return e.isValid(R)&&R(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:t.params.meshName,text:g,numericalValue:t.progress.numericalValue}})),f},t.prototype.updateMaterials=function(t){var r,i,o=t.materials.materialCloneInstructions;if(e.isValid(o)){var n=o.materialNameOrg,s=this.materials[n];if(e.isValid(n)){r=s.clone(),i=o.materialName,r.name=i;var a=o.materialProperties;for(var l in a)r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&(r[l]=a[l]);this.materials[i]=r}else console.warn('Requested material "'+n+'" is not available!')}var u=t.materials.serializedMaterials;if(e.isValid(u)&&Object.keys(u).length>0){var c,p=new THREE.MaterialLoader;for(i in u)c=u[i],e.isValid(c)&&(r=p.parse(c),this.logging.enabled&&console.info('De-serialized material with name "'+i+'" will be added.'),this.materials[i]=r)}if(u=t.materials.runtimeMaterials,e.isValid(u)&&Object.keys(u).length>0)for(i in u)r=u[i],this.logging.enabled&&console.info('Material with name "'+i+'" will be added.'),this.materials[i]=r},t.prototype.getMaterialsJSON=function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},t.prototype.getMaterials=function(){return this.materials},t}(),THREE.LoaderSupport.WorkerRunnerRefImpl=function(){function e(){var e=this;self.addEventListener("message",(function(t){e.processMessage(t.data)}),!1)}return e.prototype.applyProperties=function(e,t){var r,i,o;for(r in t)i="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),o=t[r],"function"==typeof e[i]?e[i](o):e.hasOwnProperty(r)&&(e[r]=o)},e.prototype.processMessage=function(e){if("run"===e.cmd){var t={callbackMeshBuilder:function(e){self.postMessage(e)},callbackProgress:function(t){e.logging.enabled&&e.logging.debug&&console.debug("WorkerRunner: progress: "+t)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(e.logging.enabled,e.logging.debug),this.applyProperties(r,e.params),this.applyProperties(r,e.materials),this.applyProperties(r,t),r.workerScope=self,r.parse(e.data.input,e.data.options),e.logging.enabled&&console.log("WorkerRunner: Run complete!"),t.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)},e}(),THREE.LoaderSupport.WorkerSupport=function(){var e=THREE.LoaderSupport.Validator,t=function(){function t(){this._reset()}return t.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},t.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},t.prototype.setForceCopy=function(e){this.forceCopy=!0===e},t.prototype.initWorker=function(e,t){this.runnerImplName=t;var r=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},t.prototype._receiveWorkerMessage=function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},t.prototype.setCallbacks=function(t,r){this.callbacks.meshBuilder=e.verifyInput(t,this.callbacks.meshBuilder),this.callbacks.onLoad=e.verifyInput(r,this.callbacks.onLoad)},t.prototype.run=function(t){if(e.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=t,this.started=!0,!e.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!e.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==t.cmd&&(t.cmd="run"),e.isValid(t.logging)?(t.logging.enabled=!0===t.logging.enabled,t.logging.debug=!0===t.logging.debug):t.logging={enabled:!0,debug:!1},this._postMessage()}},t.prototype._postMessage=function(){var t;e.isValid(this.queuedMessage)&&e.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(t=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[t])):this.worker.postMessage(this.queuedMessage))},t.prototype.setTerminateRequested=function(t){this.terminateRequested=!0===t,this.terminateRequested&&e.isValid(this.worker)&&!e.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},t.prototype._terminate=function(){this.worker.terminate(),this._reset()},t}();function r(){if(console.info("Using THREE.LoaderSupport.WorkerSupport version: 2.2.0"),this.logging={enabled:!0,debug:!1},void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new t}r.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},r.prototype.setForceWorkerDataCopy=function(e){this.loaderWorker.setForceCopy(e)},r.prototype.validate=function(t,r,n,s,a){if(!e.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),e.isValid(a)?this.logging.enabled&&console.info('WorkerSupport: Using "'+a.name+'" as Runner class for worker.'):(a=THREE.LoaderSupport.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "THREE.LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var l=t(i,o);l+="var Parser = "+r+";\n\n",l+=o(a.name,a),l+="new "+a.name+"();\n\n";var u=this;if(e.isValid(n)&&n.length>0){var c="",p=function(e,t){if(0===t.length)u.loaderWorker.initWorker(c+l,a.name),u.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var r=new THREE.FileLoader;r.setPath(e),r.setResponseType("text"),r.load(t[0],(function(r){c+=r,p(e,t)})),t.shift()}};p(s,n)}else this.loaderWorker.initWorker(l,a.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},r.prototype.setCallbacks=function(e,t){this.loaderWorker.setCallbacks(e,t)},r.prototype.run=function(e){this.loaderWorker.run(e)},r.prototype.setTerminateRequested=function(e){this.loaderWorker.setTerminateRequested(e)};var i=function(e,t){var r,i=e+" = {\n";for(var o in t)"string"==typeof(r=t[o])||r instanceof String?i+="\t"+o+': "'+(r=(r=r.replace("\n","\\n")).replace("\r","\\r"))+'",\n':r instanceof Array?i+="\t"+o+": ["+r+"],\n":(Number.isInteger(r)||"function"==typeof r)&&(i+="\t"+o+": "+r+",\n");return i+"}\n\n"},o=function(t,r,i,o,n){var s,a,l="",u=e.isValid(i)?i:r.name;for(var c in n=e.verifyInput(n,[]),r.prototype)s=r.prototype[c],"constructor"===c?a="\tfunction "+u+s.toString().replace("function","")+";\n\n":"function"==typeof s&&n.indexOf(c)<0&&(l+="\t"+u+".prototype."+c+" = "+s.toString()+";\n\n");l+="\treturn "+u+";\n",l+="})();\n\n";var p="";return e.isValid(o)&&(p+="\n",p+=u+".prototype = Object.create( "+o+".prototype );\n",p+=u+".constructor = "+u+";\n",p+="\n"),e.isValid(a)?l=t+" = (function () {\n\n"+p+a+l:(a=t+" = (function () {\n\n",l=(a+=p+"\t"+r.prototype.constructor.toString()+"\n\n")+l),l};return r}(),THREE.LoaderSupport.WorkerDirector=function(){var e=THREE.LoaderSupport.Validator;function t(t){if(console.info("Using THREE.LoaderSupport.WorkerDirector version: 2.2.0"),this.logging={enabled:!0,debug:!1},this.maxQueueSize=8192,this.maxWebWorkers=16,this.crossOrigin=null,!e.isValid(t))throw"Provided invalid classDef: "+t;this.workerDescription={classDef:t,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}return t.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},t.prototype.getMaxQueueSize=function(){return this.maxQueueSize},t.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},t.prototype.setCrossOrigin=function(e){this.crossOrigin=e},t.prototype.setForceWorkerDataCopy=function(e){this.workerDescription.forceWorkerDataCopy=!0===e},t.prototype.prepareWorkers=function(t,r,i){e.isValid(t)&&(this.workerDescription.globalCallbacks=t),this.maxQueueSize=Math.min(r,8192),this.maxWebWorkers=Math.min(i,16),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var o=0;o<this.maxWebWorkers;o++){var n=new THREE.LoaderSupport.WorkerSupport;n.setLogging(this.logging.enabled,this.logging.debug),n.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[o]={instanceNo:o,inUse:!1,terminateRequested:!1,workerSupport:n,loader:null}}},t.prototype.enqueueForRun=function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},t.prototype.isRunning=function(){var e=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||e.length>0},t.prototype.processQueue=function(){var e,t;for(var r in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[r]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},t.prototype._kickWorkerRun=function(t,r){r.inUse=!0,r.workerSupport.setTerminateRequested(r.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var i=this,o=t.getCallbacks(),n=this.workerDescription.globalCallbacks;r.loader=this._buildLoader(r.instanceNo);var s=new THREE.LoaderSupport.Callbacks;s.setCallbackOnLoad((function(t){e.isValid(n.onLoad)&&n.onLoad(t),e.isValid(o.onLoad)&&o.onLoad(t),i.objectsCompleted++,r.inUse=!1,i.processQueue()})),s.setCallbackOnProgress((function(t){e.isValid(n.onProgress)&&n.onProgress(t),e.isValid(o.onProgress)&&o.onProgress(t)})),s.setCallbackOnMeshAlter((function(t){e.isValid(n.onMeshAlter)&&n.onMeshAlter(t),e.isValid(o.onMeshAlter)&&o.onMeshAlter(t)})),t.callbacks=s,r.loader.run(t,r.workerSupport)},t.prototype._buildLoader=function(t){var r=this.workerDescription.classDef,i=Object.create(r.prototype);if(r.call(i,THREE.DefaultLoadingManager),!i.hasOwnProperty("instanceNo"))throw r.name+' has no property "instanceNo".';if(i.instanceNo=t,!i.hasOwnProperty("workerSupport"))throw r.name+' has no property "workerSupport".';if("function"!=typeof i.run)throw r.name+' has no function "run".';return i.hasOwnProperty("callbacks")&&e.isValid(i.callbacks)||(console.warn(r.name+' has an invalid property "callbacks". Will change to "THREE.LoaderSupport.Callbacks"'),i.callbacks=new THREE.LoaderSupport.Callbacks),i},t.prototype._deregister=function(t){if(e.isValid(t)){t.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+t.instanceNo+".");var r=t.loader.callbacks;e.isValid(r.onProgress)&&r.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[t.instanceNo]}},t.prototype.tearDown=function(t){for(var r in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=e.verifyInput(t,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[r].terminateRequested=!0},t}();